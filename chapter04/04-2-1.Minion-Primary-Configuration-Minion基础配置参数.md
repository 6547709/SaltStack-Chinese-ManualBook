# MINION PRIMARY CONFIGURATION - Minion基础配置参数

## MASTER
Default: salt

设置为master节点的主机名或者是IP地址。IPv6地址的配置方式参照[ipv6](https://docs.saltstack.com/en/latest/ref/configuration/minion.html#std:conf_minion-ipv6)。
```yaml
master: salt
```

### MASTER:PORT SYNTAX
*New in version 2015.8.0.*

master选项也可以设置成ip:port的形式。
```yaml
master: localhost:1234
```

对于带端口的IPv6地址，请记住将IP地址放在中括号里，并将该行用单引号括起来使其成为字符串:
```yaml
master: '[2001:db8:85a3:8d3:1319:8a2e:370:7348]:1234'
```
> 如果在master配置文件中也使用master_port选项指定了端口，则在minion配置中的master_port设置将会被master端的配置覆盖。
### LIST OF MASTERS SYNTAX
这个master选项还可以用来定义一个master节点列表，以启用multi-master部署模式。

```yaml
master:
  - address1
  - address2
```

*Changed in version 2014.7.0: 可以动态配置master服务器。 master选项的值可以设置为将要执行的一个模块函数，并假设返回值是所需master服务的ip或主机名。 如果是指定的一个函数，则必须同时将master_type选项设置为func，以告诉minion该值要运行的是函数而不是一个域名。*

```yaml
master: module.function
master_type: func
```

此外，如果minion不使用multi-master部署模式，还可以将minion配置为使用一个master服务的地址列表作为failover列表，先尝试第一个地址，然后尝试第二个等，直到minion成功连接。 要启用此行为，请将master_type设置为failover：
```yaml
master:
  - address1
  - address2
master_type: failover
```

## IPV6
Default: None

是否应通过IPv6连接master服务器。 默认情况下，salt minion将尝试自动检测到master连接的IPv6连接。
```yaml
ipv6: True
```

## MASTER_URI_FORMAT
*New in version 2015.8.0.*

指定master服务地址的所使用的格式。 有效选项为default或ip_only。 如果指定了ip_only，则master地址将不会拆分为IP和PORT，因此请确保在master配置设置中仅设置了IP（或域名）。
```yaml
master_uri_format: ip_only
```

## MASTER_TOPS_FIRST
*New in version 2018.3.0.*

Default: False

使用Master Tops系统定义的SLS targets通常会安排在Top File中定义的任何匹配之后执行。 将此选项设置为True可使minion首先执行Master Tops states。
```yaml
master_tops_first: True
```

## MASTER_TYPE
*New in version 2014.7.0.*

Default: str

定义master的服务类型， 可以是 str, failover, func 或者 disable.
```yaml
master_type: failover
```
如果此选项设置为故障转移，则master选项必须定义为一个master服务地址的列表。 然后，minion将会按照列表中指定的顺序尝试每个master，直到它成功连接。 还必须设置master_alive_interval，这决定了minion将验证master的存活的频率。
```yaml
master_type: func
```
如果需要通过执行函数而不是读入静态master服务的值来动态分配master服务地址，请将其设置为func。 这可用于从执行模块管理minion的master设置。 只需更改模块中的算法以返回新的master ip/fqdn，重新启动minion，它就将会连接到新的master。

从版本2016.11.0开始，此选项可以设置为disable，并且minion永远不会尝试与master设备通信。 这对于运行无master服务的minion守护进程很有用。
```yaml
master_type: disable
```

## MAX_EVENT_SIZE
*New in version 2014.7.0.*

Default: 1048576

传递非常大的事件数据时可能会导致minion消耗大量内存。 此值调整允许进入minion事件总线的消息的最大大小。 该值以字节表示。
```yaml
max_event_size: 1048576
```

## ENABLE_LEGACY_STARTUP_EVENTS
*New in version 2019.2.0.*

Default: True

当一个minion启动时，它会在事件总线上发送一个通知，其标签如下所示：salt/minion/<minion_id>/start。 由于历史原因，minion还发送了一个类似的事件，其中包含如下事件标记：minion_start。 当有许多minions时，这种重复可能会在事件总线上造成很多混乱。 在minion配置中设置enable_legacy_startup_events：False以确保仅发送salt/minion/<minion_id>/start事件。 从Salt Sodium发行版本开始，此选项将默认为False。
```yaml
enable_legacy_startup_events: True
```

## MASTER_FAILBACK
*New in version 2016.3.0.*

Default: False

如果minion处于multi-master模式并且minion配置文件中`master_type`选项设置为failover，则此设置可以设置为True以强制minion在列表中第一个master服务器恢复服务时，将自己连接的master重新切换回第一个master服务上。
```yaml
master_failback: False
```

## MASTER_FAILBACK_INTERVAL
*New in version 2016.3.0.*

Default: 0

如果minion处于multi-master模式并且minion配置文件中`master_type`选项设置为failover，并且启用了`master_failback` 选项, 那么这个配置项将定义通过ping检测top master服务是否恢复的一个时间间隔，以秒为单位。
```yaml
master_failback_interval: 0
```

## MASTER_ALIVE_INTERVAL
Default: 0

配置minion以秒为单位验证当前master服务是否存活并正常返回响应的频率。 如果minion发现现有的master服务已经死了，它将尝试与列表中的下一个master建立连接。
```yaml
master_alive_interval: 30
```

## MASTER_SHUFFLE
*New in version 2014.7.0.*

*Deprecated since version 2019.2.0.*

Default: False

> Warning：
> 在 Salt 2019.2.0及以后版本中，该配置项已经被弃用，请使用random_master作为替代。

```yaml
master_shuffle: True
```

## RANDOM_MASTER
*New in version 2014.7.0.*

*Changed in version 2019.2.0: 如果第一个master服务器在故障后重新联机，master_failback选项可以与random_master一起使用，以强制minion恢复连接到列表中的第一个master服务器。 请注意，必须将master_type设置为failover才能使master_failback设置生效。*

Default: False

如果master配置项是一个服务地址的列表，则在minion尝试连接之前会先将其洗牌，以便在所有可用主服务器上平均分发minions。 这是使用Python的random.shuffle方法实现的。

如果在“master”参数设置中将多个master服务地址定义为一个列表，则默认行为始终是尝试按列出的顺序连接到它们。 如果random_master设置为True，则以上连接行为将会在Minion启动时执行一个随机化分配。 这有助于平衡分配执行salt-call请求的许多minions的负载，例如，来自cron作业。 如果仅列出一个master服务器，则此设置会被忽略并记录一条警告信息。
```yaml
random_master: True
```
> Note: 当同时启用了 failover, master_failback 和 random_master 配置项时，只有在选择 "secondary masters" 时才会执行随机分配操作。此时排在列表第一个的master会被random.shuffle 调用所忽略。

## RETRY_DNS
Default: 30

如果名称解析失败，使用该配置项设置在尝试解析master主机名之前等待的秒数。 默认为30秒。 如果minion应该关闭而不继续重试，则设置为零。
```yaml
retry_dns: 30
```

## RETRY_DNS_COUNT
*New in version 2018.3.4.*

Default: None

如果名称解析失败，则设置解析master主机名时要执行的尝试次数。 默认情况下，minion将无限期重试。
```yaml
retry_dns_count: 3
```

## MASTER_PORT
Default: 4506

指定master服务的端口，注意这需要与Salt Master服务器上的ret_port选项一致。
```yaml
master_port: 4506
```
## PUBLISH_PORT
Default: 4505

指定master发布服务器的端口，这需要与Salt master上的publish_port选项一致。
```yaml
publish_port: 4505
```

## SOURCE_INTERFACE_NAME
*New in version 2018.3.0.*

建立与Master的连接时使用的网卡接口名称。

> 如果在命名的网卡接口上配置了多个IP地址，则将选择第一个IP地址。 在这种情况下，为了更好的选择特定地址，请考虑使用source_address选项。

> 要使用命名网卡接口中的IPv6地址，请确保minion已经启用了配置项ipv6，即`ipv6：true`。

> 如果指定的网络接口是关闭状态的，minion将避免使用它，并且把自己的服务绑定到0.0.0.0（所有接口）。

> 警告 此选项需要所选传输使用的现有版本的基础库有以下要求：
 - zeromq requires pyzmq >= 16.0.1 and libzmq >= 4.1.6
 - tcp requires tornado >= 4.5

配置样例:
```yaml
source_interface_name: bond0.1234
```

## SOURCE_ADDRESS
*New in version 2018.3.0.*

将Minion连接到Master时要使用的源IP地址或域名。 有关与Master的IPv6连接，请参阅ipv6配置项。

> 警告 此选项需要所选传输使用的现有版本的基础库要求如下：
 - zeromq requires pyzmq >= 16.0.1 and libzmq >= 4.1.6
 - tcp requires tornado >= 4.5

配置样例:
```yaml
source_address: if-bond0-1234.sjc.us-west.internal
```

## SOURCE_RET_PORT
*New in version 2018.3.0.*

将Minion连接到Master ret服务器时要使用的本地源端口。

> 警告 此选项需要所选传输使用的现有版本的基础库有以下要求：
- zeromq requires pyzmq >= 16.0.1 and libzmq >= 4.1.6
- tcp requires tornado >= 4.5

配置样例:
```yaml
source_ret_port: 49017
```

## SOURCE_PUBLISH_PORT
*New in version 2018.3.0.*

将Minion连接到master发布服务器时要使用的本地源端口。

> 警告 此选项需要所选传输使用的现有版本的基础库有以下要求：
- zeromq requires pyzmq >= 16.0.1 and libzmq >= 4.1.6
- tcp requires tornado >= 4.5

配置样例:
```yaml
source_publish_port: 49018
```

## USER
Default: root

指定运行Salt 服务进程的系统用户。
```yaml
user: root
```

## SUDO_USER
Default: ''

用户通过sudo运行salt远程执行命令。 如果启用此选项，则将使用sudo更改执行远程命令的活动用户。 如果启用，则需要允许用户通过sudoers文件访问salt minion配置为运行的用户。 最常见的选择是使用root用户。 如果设置了此选项，则还应将用户选项设置为非root用户。 如果从root minion迁移到non root minion，则应清除minion缓存，并且需要将minion pki目录更改为新用户的所有权。
```yaml
sudo_user: root
```


coming to here: https://docs.saltstack.com/en/latest/ref/configuration/minion.html#pidfile
